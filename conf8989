def create_or_update_page():
    page_id, version = get_page_id(PAGE_TITLE, SPACE_KEY)

    # DEBUG: Check if df_top4 has data
    if df_top4.empty:
        print("⚠️ No data found in df_top4! Check your CSV file or processing logic.")
        return

    # Generate Confluence Chart Macro
    chart_macro = generate_chart_macro(df_top4)

    # Build Confluence Page Content
    content = f"""
    <h1>Overall Monthly Task Usage Report</h1>
    <p>Here is the detailed report based on the uploaded CSV data:</p>
    
    <h2>Data Table</h2>
    {df_top4.to_html(index=False)}

    <h2>Charts</h2>
    {chart_macro}
    """

    if page_id:
        new_version = version + 1
        payload = {
            "id": page_id,
            "type": "page",
            "title": PAGE_TITLE,
            "space": {"key": SPACE_KEY},
            "body": {
                "storage": {
                    "value": content,
                    "representation": "storage"
                }
            },
            "version": {"number": new_version}
        }

        response = requests.put(
            f"{CONFLUENCE_URL}{page_id}",
            data=json.dumps(payload),
            auth=HTTPBasicAuth(USERNAME, API_TOKEN),
            headers={"Content-Type": "application/json"},
            verify=False
        )
    else:
        payload = {
            "type": "page",
            "title": PAGE_TITLE,
            "space": {"key": SPACE_KEY},
            "body": {
                "storage": {
                    "value": content,
                    "representation": "storage"
                }
            }
        }

        response = requests.post(
            f"{CONFLUENCE_URL}",
            data=json.dumps(payload),
            auth=HTTPBasicAuth(USERNAME, API_TOKEN),
            headers={"Content-Type": "application/json"},
            verify=False
        )

    if response.status_code == 200:
        print(f"✅ Page '{PAGE_TITLE}' updated successfully.")
    else:
        print(f"❌ Failed to update page. Status code: {response.status_code}")
        print(response.text)
